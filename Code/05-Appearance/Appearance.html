<html>
	<head><title>Dropping Down the Cupcakes</title>
		<script type="text/javascript" src="../knockout-2.2.1.js"></script>
		<script type="text/javascript" src="cupcake.js"></script>
	</head>
<body>
	<div id="KnockoutCupcake">
		<table>
			<tbody data-bind="foreach: Cupcakes"> 
				<tr> 
					<td><span data-bind="text: CakeFlavor"></span></td>
					<td><span data-bind="text: IcingFlavor"></span></td>
					<td><span data-bind="text: Decoration().Name"></span></td>
				</tr>
			</tbody>
		</table>
		<div data-bind="with: NewCake"> 
			<span>
				<label for="NewCakeFlavor">Cake:</label>
					<select id="NewCakeFlavor" data-bind="optionsCaption:'Select a flavor', options: $root.Flavors, value: CakeFlavor"></select> 
			</span>
			<span data-bind="visible: CakeFlavor() != null"> <!--Oh, what's this? We can bind to an EXPRESSION, not just an observable. Note how I must invoke the observable function -->
				<label for="NewIcingFlavor">Icing:</label>
					<select id="NewIcingFlavor" data-bind="optionsCaption:'Select a flavor', options: $root.Flavors, value: IcingFlavor"></select>
			</span>
			<span data-bind="visible: IcingFlavor() != null && CakeFlavor() != null">
				<label for="NewDecoration">Decoration:</label>
					<select id="NewDecoration" data-bind="optionsCaption:'Select a decoration', options: $root.Decorations, optionsText: 'Name', value: Decoration"></select>
			</span>
				<!-- By binding enable to CanAdd, we keep the users from making mistakes -->
			<button data-bind="click: $parent.AddCake, enable: $root.CanAdd">Add Cake</button>
		</div>
	</div>
</body>
<script type="text/javascript">
	ko.applyBindings(vm, document.getElementById("KnockoutCupcake"));
</script>
</html>